Write-Host "📍 Restored original working directory" -ForegroundColor Yellow
🏢 FMB TimeTracker On-Premises Installation (Windows Server 2022)
=================================================================
📁 Creating application directories...
🔍 Checking Node.js installation...
✅ Node.js is installed: v22.18.0
🔧 Installing PM2...

changed 440 packages in 1m

113 packages are looking for funding
  run `npm fund` for details
node.exe : npm warn deprecated inflight@1.0.6: This module is not supported, and leaks memory. Do not use it. Check out lru-cache if you want a good and tested way to coalesce async requests by a key 
value, which is much more comprehensive and powerful.
At line:1 char:1
+ & "C:\Program Files\nodejs/node.exe" "C:\Program Files\nodejs/node_mo ...
+ ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~
    + CategoryInfo          : NotSpecified: (npm warn deprec...e and powerful.:String) [], RemoteException
    + FullyQualifiedErrorId : NativeCommandError
 
npm warn deprecated rimraf@2.7.1: Rimraf versions prior to v4 are no longer supported
npm warn deprecated glob@7.2.3: Glob versions prior to v9 are no longer supported
npm warn deprecated pm2-windows-service@0.2.1: NO LONGER SUPPORTED. Use pm2-installer instead.

changed 126 packages in 16s

5 packages are looking for funding
  run `npm fund` for details
✅ PM2 installed successfully
📋 Copying application files...
🔍 Auto-detecting project directory...
✅ Found project root at: C:\fmb-timetracker
✅ Found project via current directory search
📂 Script path: C:\fmb-timetracker\fmb-onprem\scripts
📂 Source path: C:\fmb-timetracker
📂 Install path: C:\fmb-timetracker
📂 Source and destination paths are the same - running in-place installation
📂 Source: C:\fmb-timetracker
📂 Install: C:\fmb-timetracker
⏭️ Skipping file copy operation...
📋 Skipping file copy (in-place installation)
📍 Working directory set to: C:\fmb-timetracker
📦 Installing application dependencies...
node.exe : npm warn config production Use `--omit=dev` instead.
At line:1 char:1
+ & "C:\Program Files\nodejs/node.exe" "C:\Program Files\nodejs/node_mo ...
+ ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~
    + CategoryInfo          : NotSpecified: (npm warn config...t=dev` instead.:String) [], RemoteException
    + FullyQualifiedErrorId : NativeCommandError
 
npm warn ERESOLVE overriding peer dependency
npm warn While resolving: vite@7.1.3
npm warn Found: @types/node@20.16.11
npm warn node_modules/@types/node
npm warn   dev @types/node@"20.16.11" from the root project
npm warn   16 more (@types/pg, @types/body-parser, @types/connect, ...)
npm warn
npm warn Could not resolve dependency:
npm warn peerOptional @types/node@"^20.19.0 || >=22.12.0" from vite@7.1.3
npm warn node_modules/vitest/node_modules/vite
npm warn   vite@"^5.0.0 || ^6.0.0 || ^7.0.0-0" from vitest@3.2.4
npm warn   node_modules/vitest
npm warn   1 more (@vitest/mocker)
npm warn
npm warn Conflicting peer dependency: @types/node@24.3.0
npm warn node_modules/@types/node
npm warn   peerOptional @types/node@"^20.19.0 || >=22.12.0" from vite@7.1.3
npm warn   node_modules/vitest/node_modules/vite
npm warn     vite@"^5.0.0 || ^6.0.0 || ^7.0.0-0" from vitest@3.2.4
npm warn     node_modules/vitest
npm warn     1 more (@vitest/mocker)

up to date, audited 1263 packages in 3s

188 packages are looking for funding
  run `npm fund` for details

5 vulnerabilities (1 low, 3 moderate, 1 critical)

To address all issues possible (including breaking changes), run:
  npm audit fix --force

Some issues need review, and may require choosing
a different dependency.

Run `npm audit` for details.
✅ Dependencies installed
🔧 Setting up environment configuration...
⚠️ Environment template not found at: C:\fmb-timetracker\fmb-onprem\.env.fmb-onprem
⚠️ Creating basic .env file...
✅ Basic .env file created
✅ Critical files verified
🔨 Building application...

> rest-express@1.0.0 build
> vite build && esbuild server/index.ts --platform=node --packages=external --bundle --format=esm --outdir=dist

node.exe : [31mfailed to load config from C:\fmb-timetracker\vite.config.ts[39m
At line:1 char:1
+ & "C:\Program Files\nodejs/node.exe" "C:\Program Files\nodejs/node_mo ...
+ ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~
    + CategoryInfo          : NotSpecified: ([31mfailed to ....config.ts[39m:String) [], RemoteException
    + FullyQualifiedErrorId : NativeCommandError
 
[31merror during build:
Error [ERR_MODULE_NOT_FOUND]: Cannot find package '@vitejs/plugin-react' imported from C:\fmb-timetracker\vite.config.ts.timestamp-1756516335282-fc80acc16a8af.mjs
    at Object.getPackageJSONURL (node:internal/modules/package_json_reader:255:9)
    at packageResolve (node:internal/modules/esm/resolve:767:81)
    at moduleResolve (node:internal/modules/esm/resolve:853:18)
    at defaultResolve (node:internal/modules/esm/resolve:983:11)
    at ModuleLoader.defaultResolve (node:internal/modules/esm/loader:783:12)
    at #cachedDefaultResolve (node:internal/modules/esm/loader:707:25)
    at ModuleLoader.resolve (node:internal/modules/esm/loader:690:38)
    at ModuleLoader.getModuleJobForImport (node:internal/modules/esm/loader:307:38)
    at ModuleJob._link (node:internal/modules/esm/module_job:183:49)[39m
✅ Application built successfully
✅ PM2 ecosystem configuration created
🔧 Installing PM2 as Windows service...
⚠️ PM2 service installation may have issues - check manually
🔥 Configuring Windows Firewall...


Name                          : {c1307530-386c-43e6-9e5d-7ac27a74e562}
DisplayName                   : FMB TimeTracker
Description                   : 
DisplayGroup                  : 
Group                         : 
Enabled                       : True
Profile                       : Any
Platform                      : {}
Direction                     : Inbound
Action                        : Allow
EdgeTraversalPolicy           : Block
LooseSourceMapping            : False
LocalOnlyMapping              : False
Owner                         : 
PrimaryStatus                 : OK
Status                        : The rule was parsed successfully from the store. (65536)
EnforcementStatus             : NotApplicable
PolicyStoreSource             : PersistentStore
PolicyStoreSourceType         : Local
RemoteDynamicKeywordAddresses : {}
PolicyAppId                   : 

✅ Firewall rule created for port 3000

✅ FMB TimeTracker installation completed!

📋 Next steps:
1. Edit C:\fmb-timetracker\.env with your configuration
2. Run the database setup script on your MS SQL Server (HUB-SQL1TST-LIS)
3. Configure IIS reverse proxy on HUB-DEVAPP01-C3
4. Start the application: pm2 start ecosystem.config.js
5. View logs: pm2 logs
6. Check status: pm2 status

🔧 Service Management:
Start service: net start FMBTimeTracker
Stop service: net stop FMBTimeTracker
Restart service: net stop FMBTimeTracker && net start FMBTimeTracker
📍 Restored original working directory



PS C:\fmb-timetracker> 
